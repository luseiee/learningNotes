<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 1.0.3" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="Lu, Phil" />
  <title>Classic Shell Scripting Notes</title>
  <style type="text/css"  class="link">
  /*# sourceURL=madoko.css */
  
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.25em;
  }
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.5em;
  }
  .madoko .toc-contents>.tocblock>.tocitem {
    font-weight: bold;
  }
  .madoko .toc {
    margin-top: 1em;
  }
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  .madoko dl {
    margin-left: 0em;
  }
  .madoko blockquote {
    font-style: italic;
  }
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  .madoko .footnote { 
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  .madoko .align-center pre {
    text-align: left;
  }
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  .madoko .equation-before {
    float: right;
  }
  .madoko .bibitem {
    font-size: smaller;
  }
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  .madoko .hidden {
    display: none;
  }
  .madoko .invisible {
    visibility: hidden;
  }
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  .madoko ul.list-style-type-dash {
      list-style-type: none !important;
  }
  .madoko ul.list-style-type-dash > li:before {
      content: "\2013"; 
      position: absolute;
      margin-left: -1em; 
  }
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  .madoko .math-rendering {
    color: gray;
  }
  .madoko .mathdisplay {
    text-align: center;
  }
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  body.madoko, .madoko .serif {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  }
  .madoko .sans-serif {
    font-family: "Calibri", "Optima", sans-serif;
  }
  .madoko .symbol {
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  body.madoko {  
    -webkit-text-size-adjust: 100%;       
    text-rendering: optimizeLegibility;
  }
  body.madoko {
    max-width: 88ex; 
    margin: 1em auto;
    padding: 0em 2em;  
  }
  body.preview.madoko {
    padding: 0em 1em;
  }
  .madoko p {
    text-align: justify;
  }
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
    margin-top: 1.22em; 
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
    margin-top: 1ex;    
  }
  .madoko h5, .madoko h6 { 
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 { 
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 { 
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, 
  .madoko .monospace, .madoko .token-indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token-indent {
    font-size: 0.95em;
  }
  .madoko pre code {
    font-family: inherit !important;
  }
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 0.5em;    
    }
    .madoko li {
      text-align: left;
    }
  }
  
    </style>
  
  </head>
<body class="madoko">

<div class="body madoko" style="line-adjust:0">

<div class="titleblock align-center para-block" style="text-align:center;line-adjust:0">
<div class="titleheader align-center" style="text-align:center;line-adjust:0">
<div class="title para-block" style="font-size:xx-large;font-weight:bold;margin-bottom:0.5ex;line-adjust:0">Classic Shell Scripting Notes</div></div>
<div class="authors align-center" style="text-align:center;width:80%;line-adjust:0"><table class="authorrow columns block" style="margin-top:2ex;width:100%;line-adjust:0">
<tbody><tr><td class="author column" style="text-align:center;line-adjust:0">
<div class="authorname" style="font-size:large;line-adjust:0">Lu, Phil</div></td></tr></tbody></table></div></div><h2 id="section" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span>背景知识</h2>
<ul class="ul list-dash compact">
<li class="li ul-li list-dash-li compact-li">POSIX

<blockquote>
POSIX，Portable Operating System Interface。<br>
是UNIX系统的一个设计标准，很多类UNIX系统也在支持兼容这个标准，如Linux。<br>
遵循这个标准的好处是软件可以跨平台。所以windows也支持就很容易理解了，那么多优秀的开源软件，支持了这个这些软件就可能有windows版本，就可以完善丰富windows下的软件。
</blockquote></li></ul>
<h2 id="section" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span>入门</h2><h3 id="section" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.1</span>.&#8194;</span>#!</h3>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  cat &gt; nursers
  #! /bin/bash -
  
  who | wc -l</code></pre>
<p class="p noindent para-continued"><br>
之后每条命令都会用bash运行
所以，如果是py文件可以在第一行加上#! /bin/python, 这样就可以使用./来运行它
</p><h3 id="sec-printf" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.2</span>.&#8194;</span>printf</h3>
<ul class="ul list-dash compact">
<li class="li ul-li list-dash-li compact-li">printf 命令
用法与C语言非常接近
</li></ul>
<h3 id="section" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.3</span>.&#8194;</span>重定向与管道</h3><h4 id="sec--" class="h3" data-heading-depth="3" style="display:block"><span class="heading-before"><span class="heading-label">2.3.1</span>.&#8194;</span>&lt;&#160;改变标准输入</h4>
<blockquote>

<p class="p noindent">tr命令<br>
translate charactors  
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  tr -d &#39;0-9&#39;</code></pre>
<p class="p noindent para-continued">可以将标准输入中的数字全都删除
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  tr -d &#39;0-9&#39; &lt; mytext.txt</code></pre>
<p class="p noindent para-continued">这就改变了标准输入而是将txt文件中的内容进行修改
</p></blockquote><h4 id="sec--" class="h3" data-heading-depth="3" style="display:block"><span class="heading-before"><span class="heading-label">2.3.2</span>.&#8194;</span>>&#160;改变标准输出</h4><h4 id="sec--" class="h3" data-heading-depth="3" style="display:block"><span class="heading-before"><span class="heading-label">2.3.3</span>.&#8194;</span>>>&#160;输出到文件时不覆盖文件而是附加</h4><h4 id="sec--" class="h3" data-heading-depth="3" style="display:block"><span class="heading-before"><span class="heading-label">2.3.4</span>.&#8194;</span>|&#160;建立管道</h4>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  program1 | program2</code></pre>
<p class="p noindent para-continued">将program1的标准输出修改为program2的标准输入
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  tr -d &#39;\r&#39; &lt; mytext.txt | sort &gt; mytext2.txt</code></pre>
<p class="p noindent para-continued">过程:
</p>
<ol class="ol compact">
<li class="li ol-li compact-li">tr的标准输入改成mytext.txt  
</li>
<li class="li ol-li compact-li">tr的标准输出变为sort的标准输入  
</li>
<li class="li ol-li compact-li">sort的标准输出重定向到mytext2.txt  
</li></ol>
<h4 id="sec-devnulldevtty" class="h3" data-heading-depth="3" style="display:block"><span class="heading-before"><span class="heading-label">2.3.5</span>.&#8194;</span>/dev/null和/dev/tty</h4>
<p class="p noindent">/dev/null是一个垃圾桶，所有输出到这里的数据都会被扔掉  
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>    echo 12321 &gt; /dev/null</code></pre>
<p class="p noindent para-continued">/dev/tty将重定向一个终端，键盘输入maybe，所以这个是用来作为输入的
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  read password &lt; /dev/tty</code></pre>
<p class="p noindent para-continued">将会强制从/dev/tty中读取数据，一般情况下不写问题也不大貌似
</p>
<blockquote>

<p class="p noindent">stty -echo<br>
可以将输入不显示在屏幕上<br>
stty echo<br>
重新显示  
</p></blockquote><h3 id="sec-shell" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.4</span>.&#8194;</span>Shell脚本的参数</h3>
<p class="p noindent">$1代表第一个参数
$2代表第二个参数
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  cat &gt; finduser
  #! /bin/sh
  
  who | grep $1
  ^D</code></pre>
<p class="p noindent para-continued">使用的时候就可以./finduser lxc
</p><h3 id="section" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.5</span>.&#8194;</span>简单的执行跟踪</h3>
<p class="p noindent">set -x可以设置是否跟踪命令，跟踪命令是指每条命令执行时候在前面价一个 + 并显示出来
</p><h3 id="sec-profile-bashrc" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">2.6</span>.&#8194;</span>.profile .bashrc区别</h3>
<p class="p noindent">.profile是每次登陆时运行<br>
.bashrc是每次运行bash时运行
</p><h2 id="section" class="h1" data-heading-depth="1" style="display:block"><span class="heading-before"><span class="heading-label">3</span>.&#8194;</span>查找与替换</h2><h3 id="sec-breere" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.1</span>.&#8194;</span>正则表达式与BRE，ERE</h3>
<p class="p noindent">BRE是基本正则表达式(Basic Regular Expression)<br>
ERE是扩展正则表达式子(Extended Regular Expression)<br>
BRE是grep的默认，而程序中一般使用ERE，如python神马的，+就属于ERE的meta符号<br>
grep -E 表示ERE<br>
grep 则表示BRE  
</p><h3 id="section" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.2</span>.&#8194;</span>一些小笔记</h3>
<ul class="ul list-dash compact">
<li class="li ul-li list-dash-li compact-li">. 用来匹配任意一个字符
</li>
<li class="li ul-li list-dash-li compact-li">+ 是之前的字符一个或多个 <strong class="strong-star2">ERE</strong>
</li>
<li class="li ul-li list-dash-li compact-li">* 是之前的字符0个或多个
</li>
<li class="li ul-li list-dash-li compact-li">？ 是之前的字符有或没有 <strong class="strong-star2">ERE</strong>
</li>
<li class="li ul-li list-dash-li compact-li">[abc] abc中的一个
</li>
<li class="li ul-li list-dash-li compact-li">[a-f0-9] 16进制字符
</li>
<li class="li ul-li list-dash-li compact-li">(abc) 连续的abc,代表一个整体，后面可以以加入*+之类的 <strong class="strong-star2">ERE</strong>
</li>
<li class="li ul-li list-dash-li compact-li">{a,b} 表示前面的字符出现a,b次，或者可以不写b精确a次，有逗号表示没有上限
</li>
<li class="li ul-li list-dash-li compact-li">一些字符集[:alnum:], [:alpha:]
</li></ul>
<h3 id="sec-sed" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.3</span>.&#8194;</span>sed命令</h3>
<blockquote>

<p class="p noindent">sed用来处理文本里的每一行，可以查找，替换，删除，显示等等等等，其功能完全包含grep，tr等命令  
</p></blockquote>
<ul class="ul list-dash compact">
<li class="li ul-li list-dash-li compact-li">它的最为常用的功能就是s:  

<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>sed &#39;s/要匹配的字符/要替换成的字符/g&#39; file  </code></pre></li>
<li class="li ul-li list-dash-li compact-li">其中/代表分界符，可以用其他符号代替；g代表搜索全文件，不写则找到第一个就结束了  
</li>
<li class="li ul-li list-dash-li compact-li">sed也可以接受一个脚本作为输入的一部分，把其中要执行的所有sed操作全部写入这个脚本里面<br>
举个例子: 

<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>find /home/tolstoy -type d -print |    -type d表示类型为directory
sed &#39;s;/home/tolstoy/;/home/lt/;&#39; |
sed &#39;s/^/mkdir /&#39; |                    插入mkdir指令
sh -x                                  -x表示指令追踪</code></pre></li></ul>
<h3 id="sec-cut" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.4</span>.&#8194;</span>cut切割字段</h3>
<blockquote>

<p class="p noindent">cut 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段写至标准输出。<br>
如果不指定 File 参数，cut 命令将读取标准输入。必须指定 -b、-c 或 -f 标志之一。
</p>
<p class="p indent">主要参数<br>
-b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。<br>
-c ：以字符为单位进行分割。<br>
-d ：自定义分隔符，默认为制表符。<br>
-f ：与-d一起使用，指定显示哪个区域。 <br>
-n ：取消分割多字节字符。仅和 -b 标志一起使用。如果字符的最后一个字节落在由 -b 标志的 List 参数指示的<br />范围之内，该字符将被写出；否则，该字符将被排除。  
</p></blockquote>
<p class="p noindent">举2个例子：
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  cut -d : -f 1,5 /etc/passwd     该命令以:分割，取每行的第1,5列
  ls -l | cut -c 1-10             该命令取第1~10个字符，正好是文件的读写执行权限</code></pre><h3 id="sec-join" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.5</span>.&#8194;</span>join命令</h3>
<blockquote>

<p class="p noindent">将两个文件中，指定栏位内容相同的行连接起来。 
</p></blockquote><h3 id="sec-awk" class="h2" data-heading-depth="2" style="display:block"><span class="heading-before"><span class="heading-label">3.6</span>.&#8194;</span>awk</h3>
<blockquote>

<p class="p noindent">awk是一种“单命令行程序”<br>
它的使用模式为:
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  awk &#39;program&#39; [ file ]</code></pre>
<p class="p noindent para-continued">和sed命令很像<br>
其中program的基本格式为 pattern { action }
</p></blockquote>
<p class="p noindent">举个例子：
</p>
<pre class="para-block pre-fenced pre-fenced3" style="display:block"><code>  awk -F : &#39;{print $1, $5 }&#39; /etc/passwd    以:作为分隔符，输出第一字段第五字段</code></pre><span data-line=""></span></div>
<svg id='math-svg-paths' style='display:none' version='1.1' viewBox='0 0 0 0' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
<defs>
<path d='M2.022 -0.01C2.022 -0.667 1.773 -1.056 1.385 -1.056C1.056 -1.056 0.857 -0.807 0.857 -0.528C0.857 -0.259 1.056 0 1.385 0C1.504 0 1.634 -0.04 1.733 -0.13C1.763 -0.149 1.773 -0.159 1.783 -0.159S1.803 -0.149 1.803 -0.01C1.803 0.727 1.455 1.325 1.126 1.654C1.016 1.763 1.016 1.783 1.016 1.813C1.016 1.883 1.066 1.923 1.116 1.923C1.225 1.923 2.022 1.156 2.022 -0.01Z' id='g0-59'/>
<path d='M2.929 -6.376C2.929 -6.615 2.929 -6.635 2.7 -6.635C2.082 -5.998 1.205 -5.998 0.887 -5.998V-5.689C1.086 -5.689 1.674 -5.689 2.192 -5.948V-0.787C2.192 -0.428 2.162 -0.309 1.265 -0.309H0.946V0C1.295 -0.03 2.162 -0.03 2.56 -0.03S3.826 -0.03 4.174 0V-0.309H3.856C2.959 -0.309 2.929 -0.418 2.929 -0.787V-6.376Z' id='g1-49'/>
</defs>
</svg>

</body>

</html>
